<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Traduire une image, un fichier ou une URL</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>📷 Traduire depuis une image, un fichier ou une URL</h1>

    <input type="file" id="imageInput" accept="image/*,.txt,.pdf" />
    <input type="text" id="urlInput" placeholder="Ou colle ici une URL (image, page, fichier texte)" />
    <button onclick="translateContent()">Traduire</button>

    <div id="output" class="output"></div>
    <a class="btn-link" href="index.html">⬅ Retour à l'accueil</a>
  </div>

  <script>
    async function translateContent() {
      const output = document.getElementById("output");
      output.innerHTML = "⏳ Traitement en cours...";

      const fileInput = document.getElementById("imageInput").files[0];
      const urlInput = document.getElementById("urlInput").value.trim();

      let textToTranslate = "";

      if (fileInput) {
        // Si c’est une image, on doit extraire le texte (OCR via API tierce dans une version avancée)
        if (fileInput.type.startsWith("image/")) {
          output.innerHTML = "🚧 Traduction d’image à venir dans la prochaine version.";
          return;
        }
        // Si c’est un fichier texte ou PDF simple (non scanné)
        const reader = new FileReader();
        reader.onload = async function () {
          textToTranslate = reader.result;
          await fetchTranslation(textToTranslate);
        };
        reader.readAsText(fileInput);
        return;
      } else if (urlInput) {
        // Utiliser le contenu brut de l’URL – en version avancée : récupération côté serveur
        output.innerHTML = "🚧 Traduction via URL à venir dans une version future.";
        return;
      } else {
        output.innerHTML = "❌ Merci de fournir un fichier ou une URL.";
        return;
      }
    }

    async function fetchTranslation(text) {
      try {
        const res = await fetch("/.netlify/functions/translate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        const data = await res.json();
        if (data.error) {
          document.getElementById("output").innerHTML = "❌ Erreur de traduction.";
        } else {
          document.getElementById("output").innerHTML = `<strong>✅ Traduction :</strong><br>${data.translatedText}`;
        }
      } catch (err) {
        document.getElementById("output").innerHTML = "❌ Erreur lors de la connexion au serveur.";
      }
    }
  </script>
</body>
</html>
