<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Traduire Image, Fichier ou URL</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>Traduire une image, un fichier ou une URL</h2>

    <input type="file" id="imageInput" accept="image/*" />
    <button onclick="handleImage()">Traduire l'image</button>
    
    <p id="ocrStatus"></p>
    <div class="output" id="ocrOutput"></div>
    
    <a class="btn-link" href="index.html">⬅ Retour</a>
  </div>

  <script>
    async function handleImage() {
      const input = document.getElementById("imageInput");
      if (!input.files.length) return alert("Choisis une image.");

      document.getElementById("ocrStatus").innerText = "Analyse de l'image...";
      const file = input.files[0];
      const reader = new FileReader();

      reader.onload = async function () {
        const base64 = reader.result.split(",")[1];
        const ocrRes = await fetch("https://api.ocr.space/parse/image", {
          method: "POST",
          headers: { apikey: "helloworld", "Content-Type": "application/x-www-form-urlencoded" },
          body: `base64Image=data:image/jpeg;base64,${base64}`
        });

        const ocrData = await ocrRes.json();
        const detectedText = ocrData.ParsedResults?.[0]?.ParsedText || "Aucun texte trouvé.";

        const translateRes = await fetch("/.netlify/functions/translate", {
          method: "POST",
          body: JSON.stringify({ text: detectedText }),
        });
        const result = await translateRes.json();

        document.getElementById("ocrStatus").innerText = "Texte détecté :";
        document.getElementById("ocrOutput").innerText = result.translatedText || result.error;
      };

      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
