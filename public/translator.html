<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Traduire une image, un fichier ou une URL</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ“· Traduire depuis une image, un fichier ou une URL</h1>

    <input type="file" id="imageInput" accept="image/*,.txt,.pdf" />
    <input type="text" id="urlInput" placeholder="Ou colle ici une URL (image, page, fichier texte)" />
    <button onclick="translateContent()">Traduire</button>

    <div id="output" class="output"></div>
    <a class="btn-link" href="index.html">â¬… Retour Ã  l'accueil</a>
  </div>

  <script>
    async function translateContent() {
      const output = document.getElementById("output");
      output.innerHTML = "â³ Traitement en cours...";

      const fileInput = document.getElementById("imageInput").files[0];
      const urlInput = document.getElementById("urlInput").value.trim();

      let textToTranslate = "";

      if (fileInput) {
        // Si câ€™est une image, on doit extraire le texte (OCR via API tierce dans une version avancÃ©e)
        if (fileInput.type.startsWith("image/")) {
          output.innerHTML = "ğŸš§ Traduction dâ€™image Ã  venir dans la prochaine version.";
          return;
        }
        // Si câ€™est un fichier texte ou PDF simple (non scannÃ©)
        const reader = new FileReader();
        reader.onload = async function () {
          textToTranslate = reader.result;
          await fetchTranslation(textToTranslate);
        };
        reader.readAsText(fileInput);
        return;
      } else if (urlInput) {
        // Utiliser le contenu brut de lâ€™URL â€“ en version avancÃ©e : rÃ©cupÃ©ration cÃ´tÃ© serveur
        output.innerHTML = "ğŸš§ Traduction via URL Ã  venir dans une version future.";
        return;
      } else {
        output.innerHTML = "âŒ Merci de fournir un fichier ou une URL.";
        return;
      }
    }

    async function fetchTranslation(text) {
      try {
        const res = await fetch("/.netlify/functions/translate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        const data = await res.json();
        if (data.error) {
          document.getElementById("output").innerHTML = "âŒ Erreur de traduction.";
        } else {
          document.getElementById("output").innerHTML = `<strong>âœ… Traduction :</strong><br>${data.translatedText}`;
        }
      } catch (err) {
        document.getElementById("output").innerHTML = "âŒ Erreur lors de la connexion au serveur.";
      }
    }
  </script>
</body>
</html>
