<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Traduction Crochet</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>üß∂ Traduction Crochet</h1>

      <div class="translator-section">
        <textarea id="inputText" placeholder="√âcris ton texte √† traduire..."></textarea>
        <select id="languageSelect">
          <option value="en">Anglais</option>
          <option value="es">Espagnol</option>
          <option value="de">Allemand</option>
          <option value="it">Italien</option>
        </select>
        <button onclick="translateText()">üî§ Traduire</button>
        <div id="translatedResult" class="result-box"></div>
      </div>

      <hr />

      <div class="upload-section">
        <h2>üì∑ Convertir une image PDF</h2>
        <input type="file" id="imageInput" accept="image/*,application/pdf" onchange="handleImageUpload()" />
        <div id="imagePreview" class="image-preview"></div>
      </div>

      <hr />

      <div class="notes-section">
        <a href="note.html"><button>üìí Mes notes</button></a>
      </div>
    </div>

    <script>
      async function translateText() {
        const inputText = document.getElementById("inputText").value;
        const targetLang = document.getElementById("languageSelect").value;
        const resultBox = document.getElementById("translatedResult");

        resultBox.textContent = "‚è≥ Traduction en cours...";

        try {
          const response = await fetch("/.netlify/functions/translate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: inputText, targetLang })
          });

          const data = await response.json();

          if (data.translatedText) {
            resultBox.textContent = `‚úÖ ${data.translatedText}`;
          } else {
            resultBox.textContent = "‚ùå Erreur API de traduction.";
          }
        } catch (error) {
          resultBox.textContent = "‚ùå Erreur de communication avec l'API.";
        }
      }

      function handleImageUpload() {
        const input = document.getElementById("imageInput");
        const preview = document.getElementById("imagePreview");

        if (input.files && input.files[0]) {
          const file = input.files[0];
          const reader = new FileReader();

          reader.onload = function (e) {
            // Image
            if (file.type.startsWith("image/")) {
              preview.innerHTML = `<img src="${e.target.result}" alt="Image s√©lectionn√©e" class="preview-img"/>`;
            }
            // PDF
            else if (file.type === "application/pdf") {
              preview.innerHTML = `<embed src="${e.target.result}" type="application/pdf" width="100%" height="500px"/>`;
            }
          };

          reader.readAsDataURL(file);
        } else {
          preview.innerHTML = "";
        }
      }
    </script>
  </body>
</html>
