<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Traduction & Sous-titres YouTube</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
<style>
  body {
    font-family: 'Pacifico', cursive;
    background: url('fond-accueil.jpg') no-repeat center center fixed;
    background-size: cover;
    color: white;
    padding: 20px;
    margin: 0;
    min-height: 100vh;
  }
  h1, h2 {
    text-align: center;
    color: #ff69b4;
    margin-bottom: 20px;
  }
  .container {
    background: rgba(0,0,0,0.6);
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    border-radius: 12px;
  }
  select, textarea, input[type="file"], input[type="text"], button {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 8px;
    border: none;
    font-family: 'Pacifico', cursive;
    font-size: 1em;
  }
  button {
    background: linear-gradient(135deg, violet, pink);
    color: white;
    cursor: pointer;
  }
  #result, #ytTranslation {
    margin-top: 20px;
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 12px;
    white-space: pre-wrap;
    min-height: 100px;
    max-height: 300px;
    overflow-y: auto;
  }
  #videoContainer {
    margin-top: 20px;
    text-align: center;
  }
</style>
</head>
<body>

<h1>ğŸŒ Traduction & Sous-titres YouTube</h1>

<div class="container">
  <h2>Traduction de texte / image / fichier / URL</h2>
  <label for="inputType">Choisir le type d'entrÃ©e :</label>
  <select id="inputType">
    <option value="text">âœï¸ Texte</option>
    <option value="file">ğŸ“ Fichier texte (.txt)</option>
    <option value="image">ğŸ–¼ï¸ Image (OCR)</option>
    <option value="url">ğŸ”— URL (page web)</option>
  </select>

  <textarea id="manualText" placeholder="Tapez votre texte ici..."></textarea>
  <input type="file" id="fileInput" accept=".txt,image/*" style="display:none" />
  <input type="text" id="urlInput" placeholder="Collez une URL ici" style="display:none" />

  <button id="translateBtn">Traduire</button>

  <div id="result"></div>
</div>

<div class="container">
  <h2>ğŸ¥ Traduire sous-titres vidÃ©o YouTube (anglais â†’ franÃ§ais)</h2>
  <input type="text" id="youtubeUrl" placeholder="Collez un lien YouTube" />
  <button id="loadVideoBtn">Lancer la vidÃ©o</button>
  <button id="translateSubsBtn" disabled>Traduire les sous-titres</button>

  <div id="videoContainer"></div>
  <div id="ytTranslation"></div>
</div>

<script>
  const inputTypeSelect = document.getElementById('inputType');
  const manualText = document.getElementById('manualText');
  const fileInput = document.getElementById('fileInput');
  const urlInput = document.getElementById('urlInput');
  const resultDiv = document.getElementById('result');
  const translateBtn = document.getElementById('translateBtn');

  function updateInputVisibility() {
    const type = inputTypeSelect.value;
    manualText.style.display = type === 'text' ? 'block' : 'none';
    fileInput.style.display = (type === 'file' || type === 'image') ? 'block' : 'none';
    urlInput.style.display = type === 'url' ? 'block' : 'none';
    resultDiv.textContent = '';
  }
  inputTypeSelect.addEventListener('change', updateInputVisibility);
  updateInputVisibility();

  function cleanOCR(text) {
    return text.toLowerCase().replace(/[^\w\s.,:*\[\]\(\)\-Ã©Ã¨ÃªÃ«Ã Ã¢Ã¤Ã®Ã¯Ã§Ã¹Ã»Ã¼Ã´Å“â€™']/g, '');
  }

  function applyCrochetMapping(text) {
    const mapping = {
      "chain": "faire une chaÃ®nette",
      "with white yarn": "avec du fil blanc",
      "with yarn": "avec du fil",
      "st": "maille",
      "sc": "maille serrÃ©e",
      "sl st": "maille coulÃ©e",
      "hdc": "demi-bride",
      "dc": "bride",
      "tr": "double bride",
      "dtr": "triple bride",
      "yo": "faire un jetÃ©",
      "round": "tour",
      "row": "rang",
      "hook": "crochet",
      "repeat": "rÃ©pÃ©ter"
    };
    for (let key in mapping) {
      const regex = new RegExp(`\\b${key}\\b`, "gi");
      text = text.replace(regex, mapping[key]);
    }
    return text;
  }

  function translateText(text) {
    text = cleanOCR(text);
    text = applyCrochetMapping(text);
    resultDiv.textContent = text;
  }

  translateBtn.addEventListener('click', () => {
    const type = inputTypeSelect.value;
    if (type === 'text') {
      if (!manualText.value.trim()) {
        alert('Veuillez entrer du texte.');
        return;
      }
      translateText(manualText.value.trim());
    } else if (type === 'file') {
      if (!fileInput.files.length) {
        alert('Veuillez choisir un fichier texte.');
        return;
      }
      const file = fileInput.files[0];
      if (!file.name.endsWith('.txt')) {
        alert('Merci de choisir un fichier .txt');
        return;
      }
      const reader = new FileReader();
      reader.onload = () => translateText(reader.result);
      reader.readAsText(file);
    } else if (type === 'image') {
      if (!fileInput.files.length) {
        alert('Veuillez choisir une image.');
        return;
      }
      const file = fileInput.files[0];
      resultDiv.textContent = 'Analyse OCR en cours, merci de patienter...';
      Tesseract.recognize(file, 'eng')
        .then(({ data: { text } }) => translateText(text))
        .catch(() => {
          resultDiv.textContent = 'Erreur lors de la reconnaissance OCR.';
        });
    } else if (type === 'url') {
      if (!urlInput.value.trim()) {
        alert('Veuillez coller une URL.');
        return;
      }
      resultDiv.textContent = 'Chargement de la page...';
      fetch(urlInput.value.trim())
        .then(res => {
          if (!res.ok) throw new Error('Erreur lors du chargement de l\'URL');
          return res.text();
        })
        .then(text => translateText(text))
        .catch(() => resultDiv.textContent = "Impossible de charger l'URL.");
    }
  });

  // --- Section YouTube sous-titres ---
  const youtubeUrlInput = document.getElementById('youtubeUrl');
  const loadVideoBtn = document.getElementById('loadVideoBtn');
  const translateSubsBtn = document.getElementById('translateSubsBtn');
  const videoContainer = document.getElementById('videoContainer');
  const ytTranslationDiv = document.getElementById('ytTranslation');

  let currentVideoId = null;

  loadVideoBtn.addEventListener('click', () => {
    const url = youtubeUrlInput.value.trim();
    const match = url.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
    if (!match) {
      alert('Lien YouTube invalide');
      return;
    }
    currentVideoId = match[1];
    videoContainer.innerHTML = `<iframe width="100%" height="315" src="https://www.youtube.com/embed/${currentVideoId}" frameborder="0" allowfullscreen></iframe>`;
    ytTranslationDiv.textContent = '';
    translateSubsBtn.disabled = false;
  });

  translateSubsBtn.addEventListener('click', () => {
    alert('Fonction de traduction des sous-titres non implÃ©mentÃ©e dans cette version simplifiÃ©e.');
  });
</script>

</body>
</html>
