<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Traduction Crochet</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Pacifico', cursive;
      background: url('fond-accueil.jpg') center/cover no-repeat;
      margin: 0; padding: 20px;
      color: white;
    }
    h1 {
      text-align: center;
      color: #ff69b4;
    }
    .container {
      max-width: 800px;
      margin: auto;
    }
    textarea, input[type="text"] {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-family: 'Pacifico', cursive;
    }
    button {
      background: linear-gradient(135deg, violet, pink);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'Pacifico', cursive;
      font-size: 1em;
    }
    .result {
      margin-top: 20px;
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 12px;
      white-space: pre-wrap;
    }
    .lang-label {
      margin-top: 15px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß∂ Traduction Crochet</h1>
    
    <textarea id="textInput" rows="6" placeholder="Colle ton texte ici..."></textarea>
    <input type="text" id="urlInput" placeholder="... ou colle une URL">
    <input type="file" id="imageInput" accept="image/*">
    
    <button onclick="startTranslation()">Traduire automatiquement</button>
    
    <div class="result" id="resultBox"></div>
  </div>

  <script>
    async function startTranslation() {
      const text = document.getElementById('textInput').value.trim();
      const url = document.getElementById('urlInput').value.trim();
      const image = document.getElementById('imageInput').files[0];
      const resultBox = document.getElementById('resultBox');
      resultBox.textContent = "‚è≥ Traduction en cours...";

      if (text) {
        await translateAll(text, resultBox);
      } else if (url) {
        try {
          const res = await fetch(url);
          const html = await res.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          const content = doc.body.innerText.trim().slice(0, 2000);
          await translateAll(content, resultBox);
        } catch {
          resultBox.textContent = "‚ùå Erreur : URL invalide ou inaccessible.";
        }
      } else if (image) {
        resultBox.textContent = "üñºÔ∏è OCR non disponible (ajouter une API si souhait√©).";
      } else {
        resultBox.textContent = "‚ö†Ô∏è Merci de fournir un texte, une URL ou une image.";
      }
    }

    async function translateAll(text, box) {
      const chunks = text.match(/[\s\S]{1,400}/g);
      let fr = '';
      let us = '';

      for (const part of chunks) {
        const frRes = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(part)}&langpair=auto|fr`);
        const frData = await frRes.json();
        fr += frData.responseData.translatedText + " ";

        const usRes = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(part)}&langpair=auto|en-US`);
        const usData = await usRes.json();
        us += usData.responseData.translatedText + " ";
      }

      box.innerHTML = `
        <div><strong>üá´üá∑ Traduction fran√ßaise :</strong><br>${fr.trim()}</div><br>
        <div><strong>üá∫üá∏ √âquivalent am√©ricain (crochet US) :</strong><br>${us.trim()}</div>
      `;
    }
  </script>
</body>
</html>
